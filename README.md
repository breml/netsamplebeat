# Netsamplebeat

Netsamplebeat is used to sample the network traffic on selected or all network devices.
The sampling and the collected information is inspired by the 1 in N flow sampling of [sFlow](http://sflow.org/).

The main purpose of Netsamplebeat is to get a better understanding of the composition of the network traffic, processed
by a particular system (single or multi homed server, router, firewall, etc.). Especially questions like the following
might be answered:
* Which peer systems (ethernet/layer 2) generate the most traffic
* Which peer systems or source networks (ip layer/layer 3) generate the most traffic
* How is the network traffic spread amongst different protocols
* Traffic generated by arbitrary combinations of source and destination addresses and ports
* Network usage patterns for hosts or subnets during defined time periods (intra day, week, month, etc.)
* Is there an increase in TCP-packets with the syn flag set.

Due to the statistical approach (1 in N sampling), the impact in terms of system resources and latency is reduced.
Netsamplebeat is intended to be run permanently in the background.

The sampling rate for the 1 in N sampling should be adjusted based on your actual needs. You could consider the
following aspects:
* interface speed on the network device, which is sampled on (consider [sFlow sampling rate recommendations](http://blog.sflow.com/2009/06/sampling-rates.html))
* network saturation (is the available bandwidth effectively used)
* is an additional filter (BPF) applied
* what is the needed accuracy
* how much data is generated (and forwarded) by the sampling (is this in proper relation with the effective network 
traffic as well as the required reporting)


## Getting Started with Netsamplebeat

Ensure that this folder is at the following location:
`${GOPATH}/github.com/breml`

### Requirements

* [Golang](https://golang.org/dl/) 1.7

### Build

To build the binary for Netsamplebeat run the command below. This will generate a binary
in the same directory with the name netsamplebeat.

```
make
```

### Run

To run Netsamplebeat with debugging output enabled, run:

```
./netsamplebeat -c netsamplebeat.yml -e -d "*"
```


## Configuration

Find an example for the configuration in the file `netsamplebeat.yml`.


## Development

### Test

To test Netsamplebeat, run the following command:

```
make testsuite
```

alternatively:
```
make unit-tests
make system-tests
make integration-tests
make coverage-report
```

The test coverage is reported in the folder `./build/coverage/`


### Lint

To lint and check the source code, run:

```
make gometalinter
```

Follow the instructions on the [gometalinter](https://github.com/alecthomas/gometalinter) website to install `gometalinter`
including its dependencies.


### Update

Each beat has a template for the mapping in elasticsearch and a documentation for the fields
which is automatically generated based on `etc/fields.yml`.
To generate etc/netsamplebeat.template.json and etc/netsamplebeat.asciidoc

```
make update
```


### Cleanup

To clean  Netsamplebeat source code, run the following commands:

```
make fmt
make simplify
```

To clean up the build directory and generated artifacts, run:

```
make clean
```


### Clone

To clone Netsamplebeat from the git repository, run the following commands:

```
mkdir -p ${GOPATH}/github.com/breml
cd ${GOPATH}/github.com/breml
git clone https://github.com/breml/netsamplebeat
```


For further development, check out the [beat developer guide](https://www.elastic.co/guide/en/beats/libbeat/current/new-beat.html).


## Packaging

The beat frameworks provides tools to crosscompile and package your beat for different platforms. This requires [docker](https://www.docker.com/) and vendoring as described above. To build packages of your beat, run the following command:

```
make package
```

This will fetch and create all images required for the build process. The hole process to finish can take several minutes.
